<script>
  fetch('story.json')
    .then(response => response.json())
    .then(json => {
      const story = new inkjs.Story(json);

      const storyContainer = document.getElementById('story');
      const loadingContainer = document.getElementById('loading');

      // Hide the loading message now that story is ready
      loadingContainer.style.display = "none";

      function continueStory() {
        while (story.canContinue) {
          const paragraph = document.createElement('p');
          paragraph.textContent = story.Continue();
          storyContainer.appendChild(paragraph);
        }

        story.currentChoices.forEach((choice, index) => {
          const choicePara = document.createElement('p');
          choicePara.className = 'choice';
          choicePara.textContent = choice.text;
          choicePara.addEventListener('click', () => {
            story.ChooseChoiceIndex(index);
            storyContainer.innerHTML = '';
            continueStory();
          });
          storyContainer.appendChild(choicePara);
        });
      }

      continueStory();
    })
    .catch(err => {
      document.getElementById('loading').textContent = "Error loading story.";
      console.error("Story failed to load:", err);
    });
</script>
